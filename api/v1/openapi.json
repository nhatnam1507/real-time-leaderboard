{
  "components": {
    "schemas": {
      "ErrorInfo": {
        "properties": {
          "code": {
            "type": "string"
          },
          "message": {
            "type": "string"
          }
        },
        "type": "object"
      },
      "LoginRequest": {
        "properties": {
          "password": {
            "example": "password123",
            "type": "string"
          },
          "username": {
            "example": "john_doe",
            "type": "string"
          }
        },
        "required": [
          "username",
          "password"
        ],
        "type": "object"
      },
      "RegisterRequest": {
        "properties": {
          "email": {
            "example": "john@example.com",
            "format": "email",
            "type": "string"
          },
          "password": {
            "example": "password123",
            "minLength": 6,
            "type": "string"
          },
          "username": {
            "example": "john_doe",
            "maxLength": 50,
            "minLength": 3,
            "type": "string"
          }
        },
        "required": [
          "username",
          "email",
          "password"
        ],
        "type": "object"
      },
      "Response": {
        "properties": {
          "data": {
            "additionalProperties": true,
            "type": "object"
          },
          "error": {
            "$ref": "#/components/schemas/ErrorInfo"
          },
          "message": {
            "type": "string"
          },
          "meta": {
            "additionalProperties": true,
            "type": "object"
          },
          "success": {
            "type": "boolean"
          }
        },
        "type": "object"
      },
      "SubmitScoreRequest": {
        "properties": {
          "point": {
            "example": 1000,
            "minimum": 0,
            "type": "integer"
          }
        },
        "required": [
          "point"
        ],
        "type": "object"
      }
    },
    "securitySchemes": {
      "BearerAuth": {
        "bearerFormat": "JWT",
        "scheme": "bearer",
        "type": "http"
      }
    }
  },
  "info": {
    "contact": {
      "email": "support@example.com",
      "name": "API Support",
      "url": "http://www.example.com/support"
    },
    "description": "Real-time leaderboard system with REST API for score updates and Server-Sent Events (SSE) for live leaderboard updates",
    "license": {
      "name": "Apache 2.0",
      "url": "http://www.apache.org/licenses/LICENSE-2.0.html"
    },
    "termsOfService": "http://swagger.io/terms/",
    "title": "Real-Time Leaderboard API",
    "version": "1.0"
  },
  "openapi": "3.0.3",
  "paths": {
    "/auth/login": {
      "post": {
        "description": "Authenticate user with username and password, returns JWT access and refresh tokens",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Response"
                }
              }
            },
            "description": "Login successful"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Response"
                }
              }
            },
            "description": "Invalid credentials"
          }
        },
        "summary": "Login user",
        "tags": [
          "auth"
        ]
      }
    },
    "/auth/refresh": {
      "post": {
        "description": "Refresh access token using a valid refresh token. Returns new access and refresh tokens.",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "refresh_token": {
                    "type": "string"
                  }
                },
                "required": [
                  "refresh_token"
                ],
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Response"
                }
              }
            },
            "description": "Token refreshed successfully"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Response"
                }
              }
            },
            "description": "Invalid or expired refresh token"
          }
        },
        "summary": "Refresh access token",
        "tags": [
          "auth"
        ]
      }
    },
    "/auth/register": {
      "post": {
        "description": "Register a new user with username, email, and password. Returns user information and JWT tokens.",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RegisterRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Response"
                }
              }
            },
            "description": "User registered successfully"
          },
          "400": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Response"
                }
              }
            },
            "description": "Invalid request"
          },
          "409": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Response"
                }
              }
            },
            "description": "User already exists"
          }
        },
        "summary": "Register a new user",
        "tags": [
          "auth"
        ]
      }
    },
    "/leaderboard": {
      "get": {
        "description": "Server-Sent Events (SSE) stream for real-time leaderboard updates.\nReturns `text/event-stream` content type. Clients receive initial leaderboard data\nand automatic updates when scores change. Updates are pushed via Redis pub/sub\nnotifications - no polling required.\n",
        "parameters": [
          {
            "description": "Number of top players",
            "in": "query",
            "name": "limit",
            "schema": {
              "default": 10,
              "example": 10,
              "maximum": 100,
              "minimum": 1,
              "type": "integer"
            }
          },
          {
            "description": "Number of results to skip",
            "in": "query",
            "name": "offset",
            "schema": {
              "default": 0,
              "example": 0,
              "minimum": 0,
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "text/event-stream": {
                "schema": {
                  "example": "data: {\"entries\":[...],\"total\":100}\n\n",
                  "type": "string"
                }
              }
            },
            "description": "SSE stream with leaderboard data. Content-Type: text/event-stream.\nInitial leaderboard sent immediately, followed by updates when scores change.\n"
          },
          "500": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Response"
                }
              }
            },
            "description": "Internal server error"
          }
        },
        "summary": "Get leaderboard (SSE stream)",
        "tags": [
          "leaderboard"
        ]
      }
    },
    "/score": {
      "put": {
        "description": "Update the score for the authenticated user. Requires authentication.\nThe score will be upserted in PostgreSQL (backup) and updated in Redis (leaderboard).\nIf the leaderboard record doesn't exist, it will be created with the provided point.\n",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SubmitScoreRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Response"
                }
              }
            },
            "description": "Score updated successfully"
          },
          "400": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Response"
                }
              }
            },
            "description": "Invalid request"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Response"
                }
              }
            },
            "description": "Unauthorized"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Response"
                }
              }
            },
            "description": "Leaderboard record not found (user may not be registered)"
          }
        },
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "summary": "Update score",
        "tags": [
          "leaderboard"
        ]
      }
    }
  },
  "servers": [
    {
      "description": "API v1",
      "url": "/api/v1"
    }
  ],
  "tags": [
    {
      "description": "Authentication endpoints",
      "name": "auth"
    },
    {
      "description": "Leaderboard and score endpoints",
      "name": "leaderboard"
    }
  ],
  "x-tagGroups": [
    {
      "name": "v1",
      "tags": [
        "auth",
        "leaderboard"
      ]
    }
  ]
}